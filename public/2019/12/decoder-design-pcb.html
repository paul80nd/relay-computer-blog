<!DOCTYPE html>
<html lang="en">

  <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Decoder Design: Schematic &amp; PCBs | Relay Computer</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Decoder Design: Schematic &amp; PCBs" />
<meta name="author" content="Paul Law" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve almost got everything I need now to get my relay computer to do branching. The hard work of designing and constructing the sequencer and controller units is complete and both units can perform a GOTO operation. The only problem now is the decoder card doesn’t understand what a GOTO instruction looks like and so can’t tell the controller unit to perform a GOTO. That’s easily fixed though as the decoder is one of the simplest cards in my computer." />
<meta property="og:description" content="I’ve almost got everything I need now to get my relay computer to do branching. The hard work of designing and constructing the sequencer and controller units is complete and both units can perform a GOTO operation. The only problem now is the decoder card doesn’t understand what a GOTO instruction looks like and so can’t tell the controller unit to perform a GOTO. That’s easily fixed though as the decoder is one of the simplest cards in my computer." />
<link rel="canonical" href="https://relaycomputer.co.uk/2019/12/decoder-design-pcb" />
<meta property="og:url" content="https://relaycomputer.co.uk/2019/12/decoder-design-pcb" />
<meta property="og:site_name" content="Relay Computer" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-12-22T03:03:00+00:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Paul Law"},"url":"https://relaycomputer.co.uk/2019/12/decoder-design-pcb","description":"I’ve almost got everything I need now to get my relay computer to do branching. The hard work of designing and constructing the sequencer and controller units is complete and both units can perform a GOTO operation. The only problem now is the decoder card doesn’t understand what a GOTO instruction looks like and so can’t tell the controller unit to perform a GOTO. That’s easily fixed though as the decoder is one of the simplest cards in my computer.","headline":"Decoder Design: Schematic &amp; PCBs","@type":"BlogPosting","datePublished":"2019-12-22T03:03:00+00:00","dateModified":"2019-12-22T03:03:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://relaycomputer.co.uk/2019/12/decoder-design-pcb"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<!-- Begin CSS Styles -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,500,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,500,700" rel="stylesheet">
<link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/app.css">
<!-- End CSS Styles -->



<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<link type="application/atom+xml" rel="alternate" href="https://relaycomputer.co.uk/feed.xml" title="Relay Computer" />

<!-- Begin EU Cookie Consent -->
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#000"
    },
    "button": {
      "background": "#f1d600"
    }
  }
})});
</script>
<!-- End EU Cookie Consent -->


    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47484999-2', 'auto');
	ga('send', 'pageview', { 'page': location.pathname + location.search + location.hash});
	ga('set', 'anonymizeIp', false);
    </script>
    <!-- End Google Analytics -->
    </head>


  <body>
      <nav class="navbar is-primary" >
        <div class="container">
            <div class="navbar-brand">
                <a href="/" class="navbar-item">
                    Relay Computer
                </a>
                <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            <div class="navbar-menu" id="navMenu">
                <div class="navbar-start">
                    <a href="/" class="navbar-item ">Home</a>
                    
                    
                        
                        <a href="/pages/overview.html" class="navbar-item ">Overview</a>
                        
                    
                        
                        <div class="navbar-item has-dropdown is-hoverable">
                            <a href="/#" class="navbar-link ">Summaries</a>
                            <div class="navbar-dropdown">
                                
                                <a href="/pages/progress.html" class="navbar-item ">Progress</a>
                                
                                <a href="/pages/instructions.html" class="navbar-item ">Instructions</a>
                                
                                <a href="/pages/alu.html" class="navbar-item ">ALU</a>
                                
                                <a href="/pages/control.html" class="navbar-item ">Control</a>
                                
                                <a href="/pages/enclosure.html" class="navbar-item ">Enclosure</a>
                                
                                <a href="/pages/registers.html" class="navbar-item ">Registers</a>
                                
                                <a href="/pages/ui.html" class="navbar-item ">UI</a>
                                
                            </div>
                        </div>
                        
                    
                        
                        <a href="/archive.html" class="navbar-item ">Archive</a>
                        
                    
                        
                        <a href="/tags.html" class="navbar-item ">Tags</a>
                        
                    
                    
                </div>
            </div>
        </div>
    </nav>

      
        <section class="hero is-bold is-primary" >
    <div class="hero-body">
        <div class="container">                
            <h1 class="title ">Decoder Design: Schematic & PCBs</h1>
            <h2 class="subtitle"></h2>
        </div>
    </div>
</section>
      

      <section class="section">
        <div class="container">
              <div class="columns">
  <div class="column is-three-quarters-widescreen">
    <div class="content">

      <p>I’ve almost got everything I need now to get my relay computer to do branching. The hard work of designing and constructing
the sequencer and controller units is complete and both units can perform a GOTO operation. The only problem now is the
decoder card doesn’t understand what a GOTO instruction looks like and so can’t tell the controller unit to perform a GOTO.
That’s easily fixed though as the decoder is one of the simplest cards in my computer.</p>

<p>So far the existing decoder can understand ALU, MOV8 and SETAB instruction classes. Mapped out as a tree diagram it looks like
this:</p>

<figure><img src="/assets/img/posts/2015/2015-01-04-0000.png" alt="Opcode binary tree for MOV-8, ALU and SETAB" />
  
</figure>

<p>Given the GOTO instruction …</p>

<article class="box">
    <div class="content">
        <h4>Branch/Call &amp; 16-bit Load Immediate</h4>
        <div class="field is-grouped is-grouped-multiline is-family-monospace">
            <div class="control">
                <div class="tags has-addons are-medium">
                    <span class="tag is-primary">GOTO</span>
                    <span class="tag is-success">24</span>
                </div>
            </div>              
            <div class="control">
                <div class="tags has-addons are-medium" style="margin-bottom: 0;">
                    <span class="tag is-link">1</span>
                    <span class="tag is-link">1</span>
                    <span class="tag is-info">d</span>
                    <span class="tag is-info">s</span>
                    <span class="tag is-info">c</span>
                    <span class="tag is-info">z</span>
                    <span class="tag is-info">n</span>
                    <span class="tag is-info">x</span>
                </div>
                
                <div class="tags has-addons are-medium" style="margin-bottom: 0;">
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                    <span class="tag is-info">h</span>
                </div>
                <div class="tags has-addons are-medium" style="margin-bottom: 0;">
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                    <span class="tag is-info">l</span>
                </div>
                
            </div>        
        </div>
        <pre class="is-size-7"><code>d = destination register (0-M, 1-J)<br />s = 1 = load PC if sign bit is set (if negative); 0 = ignore sign bit<br />c = 1 = load PC if carry bit is set (if carry); 0 = ignore carry bit<br />z = 1 = load PC if zero bit set (if result is zero); 0 = ignore if zero bit set<br />n = 1 = load PC if zero bit clear (if result is not zero); 0 = ignore if zero bit clear<br />x = 1 = copy PC to XY; 0 = no copy<br />hhhhhhhh = address high byte (to set in M2/J2)<br />llllllll = address low byte (to set in M1/J1)</code></pre>
    </div> 
</article>

<p>… we can see that it will always start with ‘11’ and so updating the tree diagram is simple enough. However, as I want
to design and build this card completely I’m going to add the other instruction classes I know my computer will be needing. I
won’t cover these in too much detail yet (I’ll save those for another time) but suffice to say that the controller cards are
already capable of performing these instruction classes - they’ll just need more relays soldering into the existing PCB.
Anyho, here’s the complete decoder tree diagram:</p>

<figure><img src="/assets/img/posts/2019/2019-12-22-0000.png" alt="Opcode binary tree all instruction classes" />
  
</figure>

<p>You can perhaps see that designing these opcodes requires quite a bit of thought. The MOV8 instruction, for example, starts
with a ‘00’ because we want to reserve the following six bits as parameters to that instruction type - same goes for the GOTO
instruction. However that means we’ve already used up half of the opcode permutations. The SETAB instruction (starting with
‘01’) polishes off another quarter as it also needs six bits for its parameters.</p>

<p>So, that leaves us with a quarter of the possible opcode permutations for everything else. Fortunately most of the remaining
instructions aren’t quite as parameter hungry … or rather, they’ve been designed that way. This is why sometimes an
instruction is limited in what it can do. For example, SETAB can only load register A or B because otherwise we’d need to find
an extra bit in the instruction at the cost of another instruction.</p>

<p>Another way of visualising the possible permutations of instructions is via a map which shows how much ‘space’ each
instruction class takes up what’s available:</p>

<figure><img src="/assets/img/posts/2019/2019-12-22-0001.png" alt="Opcode class map" />
  
</figure>

<p>You can see that we have several blank sections marked ‘NOP’ which stands for ‘No Operation’. These are areas where there’s
potential space for adding more instruction types in the future.</p>

<p>Right, let’s move on to designing the relay logic for the decoder and all we need to do is wire out the tree map you see
above:</p>

<figure><img src="/assets/img/posts/2019/2019-12-22-0002.png" alt="Decoder relay logic" />
  
</figure>

<p>To that we just add the standard W1 backplane connectors which will bring in power, control/instruction bus, operation bus and the pulse bus. For this card the instruction bus is our input and the operation bus is the output. Finally the card needs
a set of LEDs on the front to display the currently decoded instruction class. This all results in the final schematic
which you <a href="/assets/pdf/decoder.pdf">can find here in PDF format</a>.</p>

<p>For the PCB design we follow the usual steps: place components that have to be in a certain location first; place other
components in rough logical groups; lay tracks; build ground/power planes; add text labels etc. Being as this card is so
straightforward let’s skip to the finished design - here’s a ‘realistic’ image of the final board design:</p>

<figure>
  <img src="/assets/img/posts/2019/2019-12-22-0003.png" alt="Upper Card (front)" />
  <img src="/assets/img/posts/2019/2019-12-22-0004.png" alt="Upper Card (rear)" />
  
  <figcaption>Decoder Card (front and rear)</figcaption>
</figure>

<p>If you’d like to take a closer look at these you can find the full colour previews in
<a href="/assets/pdf/decoder-pcbp.pdf">PDF format here</a> and <a href="/assets/pdf/decoder-pcb.pdf">another version here</a>
which seperates the layers out.</p>

<p>That’s the decoder design fully complete and so all I’ve got to do now is solder it up and the computer should be ready
to perform its very first branching program.</p>


    </div>

    <div class="field is-grouped is-grouped-multiline">
      <div class="control">
        <a href="/archive#2019" class="tags has-addons">
          <span class="tag is-link">Published</span>
          <span class="tag is-info">Dec 22, 2019</span>
        </a>
      </div>
      
      <div class="control">
        <a href="/tags#decoder" class="tags">
          <span class="tag is-primary">decoder</span>
        </a>
      </div>
      
      <div class="control">
        <a href="/tags#design" class="tags">
          <span class="tag is-primary">design</span>
        </a>
      </div>
      
    </div>

    <div class="columns">
      <div class="column">
        
          <span class="has-text-weight-semibold">Previous Post</span><br />
          <a href="/2019/12/controller-construction">Controller Construction</a>
                
      </div>
      <div class="column has-text-right">
        
          <span class="has-text-weight-semibold">Next Post</span><br />
          <a href="/2020/01/decoder-construction">Decoder Construction</a>
                
      </div>
    </div>

  </div>
</div>
        </div>
      </section>
          
      <footer class="footer">
    <div class="container">
        <div class="columns">
            <div class="column">   
                <h3>On this blog</h3>  
                <p><a href="/index.html">Home</a></p>
                <p><a href="/archive">Archive</a></p>
                <p><a href="/tags">Tags</a></p>
                <p><a href="/pages/progress">Progress</a></p>
            </div>        
            <div class="column">
                <h3>Related sites</h3>
                <p><a href="https://www.youtube.com/channel/UCDn07eKw2HDPIgSAGQgliAA"><span class="fab fa-youtube fa-lg fa-fw"></span> YouTube Channel</a></p>
                <p><a href="https://github.com/paul80nd"><span class="fab fa-github fa-lg fa-fw"></span> GitHub Repos</a></p>
                <p><a href="http://simulator.relaycomputer.co.uk"><span class="fas fa-flask fa-lg fa-fw"></span> Relay Simulator</a></p>
            </div>
            <div class="column">
                <h3>Share on social media</h3>
                <p><a href="https://www.facebook.com/sharer/sharer.php?u=&amp;quote=" target="_blank"><span class="fab fa-facebook fa-lg fa-fw"></span> Share on Facebook</a></p>
                <p><a href="https://twitter.com/intent/tweet?source=&amp;text=" target="_blank"><span class="fab fa-twitter fa-lg fa-fw"></span> Tweet</a></p>
                <p><a href="http://www.tumblr.com/share?v=3&amp;u=&amp;quote=&amp;s=" target="_blank"><span class="fab fa-tumblr fa-lg fa-fw"></span> Post to Tumblr</a></p> 
                <p><a href="http://pinterest.com/pin/create/button/?url=&amp;description=" target="_blank"><span class="fab fa-pinterest fa-lg fa-fw"></span> Pin it</a></p> 
                <p><a href="http://www.reddit.com/submit?url=&amp;title=" target="_blank"><span class="fab fa-reddit fa-lg fa-fw"></span> Submit to Reddit</a></p>   
                <p><a href="mailto:?subject=&amp;body=" target="_blank"><span class="fas fa-envelope fa-lg fa-fw"></span> Send email</a></p> 
            </div>
        </div>                    
    </div>
</footer>

      <script src="/assets/js/app.js" type="text/javascript"></script>
  </body>

</html>